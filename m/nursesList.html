<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8" />
	<title>护工列表</title>
    <meta name="viewport" content="width=320,user-scalable=no" />
	<meta content="telephone=no" name="format-detection" />
	<link href="./css/style.css" rel="stylesheet" />
</head>
<body id="page-nurses-list">
	
	<header id="header">
		<a class="back" href="javascript:history.back(1)">返回</a>
		<h2 class="title">护工列表</h2>
        <a class="home" href="/">首页</a>
	</header>
	<ul class="nurses-list" id="body">
	</ul>
    <div class="loading-more loading"></div>

    <script id="bodyTemplate" type='text/html'>
    {{each data as value index}}
    <a href="./nursesDetail.html?worker_id={{value.worker_id}}">
    <li>
        <div class="nurses-photo" style="background-image:url({{value.pic}})"></div>
        <div class="nurses-detail">
            <span class="nurses-price"><em>{{value.price}}</em>元/天</span>
            <span class="nurses-rate">{{worker_star(value.star)}}</span>
            <h4 class="nurses-name">{{value.name}}</h4>
            <p class="nurses-intro">{{dateFormat(value.birth)}}岁 | {{value.native_province}} | {{dateFormat(value.start_work)}}年陪护经验</p>
            <p class="nurses-reserve">
                {{if value.level==1}}
                    <span class="care-level-middle">
                {{else if value.level==2}}
                    <span class="care-level-middle">
                {{else if value.level==3}}
                    <span class="care-level-hight">
               {{else if value.level==4}}
                    <span class="care-level-special">
                {{/if}}
                {{worker_levels(value.level)}} {{value.office_id}}</span>

            </p>
        </div>
    </li>
    </a>
    {{/each}}
    </script>

    <script type='text/javascript' src='/js/zepto.min.js'></script>
    <script type='text/javascript' src='/js/template.js'></script>
    <script type='text/javascript' src='/js/public.js'></script>
    <script type="text/javascript" src="/js/worker/worker.js"></script>
    <script type="text/javascript" src="/js/zepto-with-touch.min.js"></script>
<script type="text/javascript">
    ~function () {
        var list = document.querySelector('.nurses-list'), loading = document.querySelector('.loading'), isLoading = 0;
        function load() {
            if (loading && !isLoading) {
                var bounds = loading.getBoundingClientRect();
                if (bounds.bottom < document.documentElement.clientHeight + 200) {
                    isLoading = 1;
                    window.removeEventListener('scroll', load);
                    var pageNum=1;
                    if(list.children.length>=10){
                        pageNum =Math.ceil(list.children.length/10)+1;
                    }
                    //var start_time = getUrlQueryString("start_time");
                    //var hospital_id = getUrlQueryString("hospital_id");
                    //var department_id = getUrlQueryString("department_id");
                    $.ajax({
                        url: 'http://api.youaiyihu.com/v2/workers',
                        data: { page: pageNum, count: 100},
                        type: 'get',
                        success: function (response) {
                            if (response.data.items.length<1) {
                                window.removeEventListener('scroll', load);
                                loading.classList.remove('loading');

                                loading.innerHTML = '\u5df2\u7ecf\u5230\u6700\u540e\u4e86~';
                                loading = null;
                            } else {
                                //alert(response.data.items.length);
                                var responseHtml="";
                                for(var i=0;i<response.data.items.length;i++){
                                    //alert(response.data.items[i].name);
                                    //responseHtml='';
                                    responseHtml+='<li>';
                                    responseHtml+='<a href="./nursesDetail.html?worker_id='+response.data.items[i].worker_id+'">';
                                    responseHtml+='<div class="nurses-photo" style="background-image: url('+response.data.items[i].pic+')"></div>';
                                    responseHtml+='<div class="nurses-detail">';
                                    responseHtml+='<span class="nurses-price"><em>'+parseInt(response.data.items[i].price)+'</em>元/小时</span>';
                                    responseHtml+='<span class="nurses-rate">★★★★★</span>';
                                    responseHtml+='<h4 class="nurses-name">'+response.data.items[i].name+'</h4>';
                                    responseHtml+='<p class="nurses-intro">'+ages(response.data.items[i].birth)+'岁 | '+response.data.items[i].native_province+' | '+ages(response.data.items[i].start_work)+'年从业经验</p>';
                                    responseHtml+='<p class="nurses-reserve">';
                                    responseHtml+='<span class=" ';
                                    if(response.data.items[i].level==1) responseHtml+='care-level-middle';
                                    else if (response.data.items[i].level==2) responseHtml+='care-level-middle';
                                    else if (response.data.items[i].level==3) responseHtml+='care-level-hight';
                                    else if (response.data.items[i].level==4) responseHtml+='care-level-special';
                                    responseHtml+='">'+worker_levels[response.data.items[i].level-1].name+' '+response.data.items[i].office_id+'</span>';
                                    responseHtml+='</p>';
                                    responseHtml+='</div>';
                                    responseHtml+='</a>';
                                    responseHtml+='</li> ';

                                }
                                if (list.insertAdjacentHTML) {
                                    list.insertAdjacentHTML('beforeEnd', responseHtml);
                                } else {
                                    var fra = document.createDocumentFragment(), temp = document.createElement('div');
                                    div.innerHTML = responseHtml;
                                    [].forEach.call(div.children, function (li) {
                                        fra.appendChild(li);
                                    });
                                    list.appendChild(fra);
                                }
                                isLoading && window.addEventListener('scroll', load);
                                isLoading = 0;
                            }
                        },
                        error: function () {
                            isLoading && window.addEventListener('scroll', load);
                            isLoading = 0;
                        }
                    });
                }
            }
        }
        window.addEventListener('load', load);
    }();
</script>
</body>
</html>
